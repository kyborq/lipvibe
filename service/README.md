# LipVibe Service

Сервис для виртуальной примерки помады с использованием искусственного интеллекта. Сервис анализирует фотографию лица, определяет подходящие оттенки помады и позволяет "примерить" их виртуально.

## Описание моделей

Сервис использует несколько моделей машинного обучения:

1. **Face Detection** - для определения и обрезки лица на фотографии
2. **Face Parsing** - для сегментации губ на лице
3. **CLIP** - для подбора оттенков помады на основе визуального сходства

## Требования к системе

- Python 3.8 или выше
- Windows 10/11 или Linux
- Минимум 4GB RAM
- Для GPU-ускорения: NVIDIA GPU с CUDA

## Установка

### 1. Подготовка окружения

```bash
# Создаем виртуальное окружение
python -m venv venv

# Активируем виртуальное окружение
# Для Windows:
venv\Scripts\activate
# Для Linux:
source venv/bin/activate
```

### 2. Установка зависимостей

```bash
# Устанавливаем все необходимые пакеты
pip install -r requirements.txt
```

### 3. Установка dlib (если возникли проблемы)

#### Для Windows:

1. Установите Visual Studio Build Tools 2019
2. Установите CMake
3. Выполните:

```bash
pip install dlib
```

#### Для Linux:

```bash
sudo apt-get install cmake
sudo apt-get install libopenblas-dev
pip install dlib
```

## Запуск сервера

1. Активируйте виртуальное окружение (если еще не активировано):

```bash
# Для Windows:
venv\Scripts\activate
# Для Linux:
source venv/bin/activate
```

2. Запустите сервер:

```bash
uvicorn server:app --reload
```

Сервер будет доступен по адресу: http://localhost:8000

## Использование API

### 1. Анализ фотографии и получение рекомендаций

```bash
curl -X POST "http://localhost:8000/analyze" \
     -H "accept: application/json" \
     -H "Content-Type: multipart/form-data" \
     -F "file=@путь_к_фотографии.jpg"
```

### 2. Получение обработанных изображений

После анализа вы получите JSON-ответ с:

- Списком рекомендованных оттенков помады
- URL для получения обрезанного изображения лица
- URL для получения изображения с наложенным оттенком помады

### 3. Документация API

Полная документация API доступна по адресу:
http://localhost:8000/docs

## Структура проекта

```
service/
├── analysis/           # Модули анализа изображений
│   ├── face_crop.py   # Обрезка лица
│   ├── lip_filter.py  # Наложение помады
│   └── recommender.py # Рекомендации оттенков
├── database/          # Работа с базой данных
│   └── schema.py     # Схема и инициализация БД
├── temp/             # Временные файлы
├── server.py         # FastAPI сервер
└── requirements.txt  # Зависимости проекта
```

## Возможные проблемы и их решение

1. **Ошибка при установке dlib**

   - Убедитесь, что установлены все необходимые инструменты сборки
   - Попробуйте установить предварительно скомпилированную версию

2. **Ошибка CUDA**

   - Если нет GPU NVIDIA, сервис будет использовать CPU
   - Для ускорения работы рекомендуется использовать GPU

3. **Проблемы с памятью**
   - Увеличьте размер файла подкачки
   - Используйте изображения меньшего размера

## Лицензия

MIT License
